<!DOCTYPE html>
<html lang="en" >

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{ board_name|capitalize }} • Flux Imageboard</title>

  <style>
    /* base & reset */
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0; padding: 0;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #121212 0%, #1f1f2e 100%);
      color: #eee;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    a {
      color: #45a29e;
      text-decoration: none;
      transition: color 0.2s ease-in-out;
    }
    a:hover {
      color: #66fcf1;
    }

    header {
      background: #0f0f15cc;
      padding: 1rem 2rem;
      text-align: center;
      font-size: 1.8rem;
      font-weight: 700;
      letter-spacing: 0.1em;
      color: #66fcf1;
      user-select: none;
      text-shadow: 0 0 8px #45a29e;
    }

    main.container {
      flex-grow: 1;
      max-width: 1100px;
      margin: 2rem auto 4rem;
      padding: 0 1rem;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.8rem;
    }

    /* upload panel */
    .upload-panel {
      grid-column: 1/-1;
      background: #222630cc;
      border-radius: 14px;
      padding: 1.6rem 2rem;
      display: flex;
      justify-content: center;
      gap: 1rem;
      flex-wrap: wrap;
      box-shadow: 0 0 12px #45a29e66;
      user-select: none;
    }
    .upload-panel form {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      width: 100%;
      max-width: 600px;
    }
    input[type="file"] {
      flex: 1 1 40%;
      background: #111;
      color: #eee;
      border-radius: 12px;
      padding: 0.8rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    input[type="file"]::file-selector-button {
      background: #45a29e;
      border: none;
      padding: 0.7rem 1.2rem;
      border-radius: 12px;
      color: #121212;
      font-weight: 700;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    input[type="file"]::file-selector-button:hover {
      background: #66fcf1;
    }
    input[type="text"] {
      flex: 1 1 50%;
      background: #1c1f28;
      color: #eee;
      border-radius: 12px;
      padding: 0.8rem 1rem;
      border: none;
      font-size: 1rem;
      outline-offset: 2px;
      outline-color: #45a29e;
      transition: background-color 0.3s ease;
    }
    input[type="text"]:focus {
      background-color: #283040;
    }
    button.btn {
      background: #45a29e;
      border: none;
      border-radius: 12px;
      padding: 0.9rem 2rem;
      color: #121212;
      font-weight: 700;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s ease, transform 0.15s ease;
    }
    button.btn:hover {
      background: #66fcf1;
      transform: scale(1.05);
    }
    button.btn:active {
      transform: scale(0.95);
    }

    /* warning */
    .warning {
      grid-column: 1/-1;
      background: #ffcc0044;
      color: #222;
      padding: 1rem 2rem;
      border-radius: 10px;
      font-weight: 600;
      text-align: center;
      margin-bottom: 1rem;
      user-select: none;
      box-shadow: 0 0 8px #ffcc00aa;
    }

    /* image card */
    .image-card {
      background: #191c27cc;
      border-radius: 14px;
      box-shadow: 0 0 12px #45a29e99;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      user-select: none;
      position: relative;
      transition: box-shadow 0.3s ease;
    }
    .image-card:hover {
      box-shadow: 0 0 20px #66fcf1cc;
    }
    .image-thumb {
      width: 100%;
      max-height: 180px;
      object-fit: contain;
      cursor: zoom-in;
      background: #111;
      border-bottom: 1.5px solid #45a29e88;
      transition: transform 0.35s ease;
      border-radius: 0 0 0 0;
    }
    .image-thumb.zoomed {
      cursor: zoom-out;
      position: fixed;
      top: 50%;
      left: 50%;
      max-width: 90vw;
      max-height: 90vh;
      transform: translate(-50%, -50%);
      z-index: 1001;
      border-radius: 12px;
      box-shadow: 0 0 30px #45a29eee;
      transition: transform 0.25s ease;
    }

    /* overlay for zoom */
    #overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      display: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    #overlay.active {
      display: block;
      opacity: 1;
      cursor: zoom-out;
    }

    .caption {
      padding: 0.75rem 1rem;
      font-size: 1rem;
      font-weight: 600;
      color: #66fcf1cc;
      min-height: 2.2rem;
      user-select: text;
      background: linear-gradient(90deg, #45a29e22 0%, #66fcf140 100%);
      border-bottom: 1.5px solid #45a29e88;
    }

    /* delete form */
    .delete-form {
      padding: 1rem;
      background: #2c2f3dcc;
      border-top: 1.5px solid #b22222aa;
      display: flex;
      gap: 0.75rem;
      justify-content: center;
      align-items: center;
    }
    .delete-form input[type="password"] {
      background: #222;
      border-radius: 12px;
      padding: 0.6rem 1rem;
      border: none;
      color: #eee;
      flex-grow: 1;
      font-weight: 600;
      font-size: 1rem;
      outline-offset: 2px;
      outline-color: #b22222;
      transition: background-color 0.3s ease;
    }
    .delete-form input[type="password"]:focus {
      background-color: #441111;
    }
    .delete-form button {
      background: #b22222;
      border: none;
      border-radius: 12px;
      padding: 0.7rem 1.6rem;
      font-weight: 700;
      color: #eee;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s ease;
    }
    .delete-form button:hover {
      background: #d33333;
    }
    .delete-form button:active {
      background: #a11111;
    }

    /* comments */
    .comment-section {
      background: #222734cc;
      padding: 1rem 1rem 1.5rem;
      border-top: 1.5px solid #45a29e88;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      gap: 0.7rem;
      user-select: text;
    }
    .comment-section h3 {
      margin: 0 0 0.5rem;
      font-weight: 700;
      color: #66fcf1;
      user-select: none;
    }
    .comment-section form {
      display: flex;
      gap: 0.6rem;
    }
    .comment-section input[type="text"] {
      flex-grow: 1;
      background: #1b2132;
      border-radius: 12px;
      padding: 0.6rem 1rem;
      border: none;
      color: #eee;
      font-size: 1rem;
      outline-offset: 2px;
      outline-color: #45a29e;
      transition: background-color 0.3s ease;
    }
    .comment-section input[type="text"]:focus {
      background-color: #283040;
    }
    .comment-section button {
      background: #45a29e;
      border: none;
      border-radius: 12px;
      padding: 0.6rem 1.5rem;
      color: #121212;
      font-weight: 700;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s ease, transform 0.15s ease;
    }
    .comment-section button:hover {
      background: #66fcf1;
      transform: scale(1.05);
    }
    .comment-section button:active {
      transform: scale(0.95);
    }
    ul.comments-list {
      list-style: none;
      margin: 0.5rem 0 0 0;
      padding: 0;
      max-height: 130px;
      overflow-y: auto;
      border-radius: 8px;
      background: #141820;
      box-shadow: inset 0 0 5px #45a29e88;
      scrollbar-width: thin;
      scrollbar-color: #45a29e #121318;
    }
    ul.comments-list::-webkit-scrollbar {
      width: 7px;
    }
    ul.comments-list::-webkit-scrollbar-thumb {
      background-color: #45a29e;
      border-radius: 8px;
    }
    ul.comments-list li {
      padding: 0.5rem 0.8rem;
      border-bottom: 1px solid #283040;
      font-size: 0.9rem;
      color: #cdd6f4;
      line-height: 1.3;
      word-wrap: break-word;
      user-select: text;
    }
    ul.comments-list li:last-child {
      border-bottom: none;
    }
    .hidden-comment {
      display: none;
    }
    .show-more-btn {
      margin-top: 0.5rem;
      background: transparent;
      border: none;
      color: #66fcf1cc;
      font-weight: 600;
      cursor: pointer;
      user-select: none;
      align-self: flex-start;
      padding-left: 0;
      font-size: 0.9rem;
      transition: color 0.2s ease;
    }
    .show-more-btn:hover {
      color: #66fcf1;
      text-decoration: underline;
    }
  </style>

</head>

<body>
  <header>
    {{ board_name|capitalize }} • Flux Imageboard
  </header>

  <main class="container">
    <div class="warning" role="alert">
      WARNING: IMAGES CLEARED RANDOMLY. NO NSFW. KEEP IT CLEAN. NO EXCUSES. THIS IS A GENERATED BOARD ( IT MEANS LLM TOTALLY MADE IT NO OPINIONS WERE GIVEN TO ITS DESIGN UNLIKE NON GENERATED BOARDS IN WHICH HUMAN INPUT IS PROVIDED )
    </div>

    <section class="upload-panel" aria-label="Upload new image">
      <form action="{{ url_for('upload', board_name=board_name) }}" method="post" enctype="multipart/form-data" autocomplete="off" novalidate>
        <input type="file" name="image" accept="image/*" required aria-required="true" aria-label="Select image file" />
        <input type="text" name="caption" placeholder="Optional caption" autocomplete="off" aria-label="Caption for the image" />
        <button type="submit" class="btn" aria-label="Upload image">Upload</button>
      </form>
    </section>

    {% for image in images %}
    <article class="image-card" aria-labelledby="caption-{{ image.image_id }}">
      <img src="{{ image.image_url }}" alt="{{ image.caption_of_image or 'User uploaded image' }}" loading="lazy"
        class="image-thumb" data-image-id="{{ image.image_id }}" tabindex="0" aria-describedby="caption-{{ image.image_id }}" />

      <div class="caption" id="caption-{{ image.image_id }}">{{ image.caption_of_image or 'No caption' }}</div>

      <section class="delete-form" aria-label="Delete image form">
        <form action="{{ url_for('delete_image', image_id=image.image_id) }}" method="post" autocomplete="off" novalidate>
          <input type="password" name="password" placeholder="Password" required aria-required="true" aria-label="Password for delete" />
          <button type="submit" aria-label="Delete image">Delete</button>
        </form>
      </section>

      <section class="comment-section" aria-label="Comments for image {{ image.image_id }}">
        <h3>Comments</h3>
        <form action="{{ url_for('comment', image_id=image.image_id) }}" method="post" autocomplete="off" novalidate>
          <input type="text" name="comment" placeholder="Add a comment" required aria-required="true" aria-label="Add a comment" />
          <button type="submit" aria-label="Post comment">Post</button>
        </form>
        <ul id="comments-{{ image.image_id }}" class="comments-list" tabindex="0">
          {% set image_comments = comments | selectattr('image_id', 'equalto', image.image_id) | list %}
          {% for comment in image_comments %}
          <li class="{{ 'hidden-comment' if loop.index > 5 else '' }}">{{ comment.comment }}</li>
          {% endfor %}
          {% if image_comments|length == 0 %}
          <li>No comments yet.</li>
          {% endif %}
        </ul>

        {% if image_comments|length > 5 %}
        <button class="show-more-btn" id="read-more-{{ image.image_id }}" aria-expanded="false" aria-controls="comments-{{ image.image_id }}">
          Show More Comments
        </button>
        {% endif %}
      </section>
    </article>
    {% endfor %}
  </main>

  <!-- overlay for zoom -->
  <div id="overlay" tabindex="-1" aria-hidden="true"></div>

  <script>
    // comment show more toggle - progressive reveal
    document.addEventListener("DOMContentLoaded", () => {
      document.querySelectorAll("[id^='read-more-']").forEach(btn => {
        btn.addEventListener("click", () => {
          const imageId = btn.id.replace("read-more-", "");
          const ul = document.getElementById(`comments-${imageId}`);
          ul.querySelectorAll(".hidden-comment").forEach(li => li.classList.remove("hidden-comment"));
          btn.style.display = "none";
        });
      });

      // image zoom handler + overlay
      const overlay = document.getElementById("overlay");
      document.querySelectorAll(".image-thumb").forEach(img => {
        img.addEventListener("click", () => {
          toggleZoom(img);
        });
        img.addEventListener("keydown", e => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            toggleZoom(img);
          }
        });
      });

      overlay.addEventListener("click", () => {
        const zoomed = document.querySelector(".image-thumb.zoomed");
        if (zoomed) toggleZoom(zoomed);
      });

      function toggleZoom(img) {
        const isZoomed = img.classList.contains("zoomed");
        if (!isZoomed) {
          img.classList.add("zoomed");
          overlay.classList.add("active");
          overlay.setAttribute("aria-hidden", "false");
          img.setAttribute("aria-expanded", "true");
          // lock scroll
          document.body.style.overflow = "hidden";
          img.focus();
        } else {
          img.classList.remove("zoomed");
          overlay.classList.remove("active");
          overlay.setAttribute("aria-hidden", "true");
          img.setAttribute("aria-expanded", "false");
          document.body.style.overflow = "";
        }
      }
    });
  </script>
</body>

</html>
